\chapter{Numerical Experiments}
\label{chap:num experiments}
This chapter is entirely devoted to solving stiff PDEs prevalent in a number of fields. The experiments we demonstrate will fall under three categories: image inpainting, interface motion, and phase separation. For each problem, we will give the PDE model and then discuss how we stabilize and select the parameters. Our experiments will show the feasibility of these schemes in 2D and 3D. 

Before we proceed further, we would like to make a few notes on our implementation of these schemes. As stated from the outset, our goal is to provide simple, accurate, and efficient time stepping methods for nonlinear PDEs. Too often, new efficient methods are so complicated that the user resorts to simple explicit schemes known to require lengthy computing time rather than invest an indeterminate amount of time understanding, implementing, and debugging.

In our implementation, the choice of $p$ is fixed throughout the time evolution. This is not the only way as one may want to adapt $p$ as the solution evolves. This could be advantageous as overestimates of $p$ lead to larger errors. However, we do not pursue that here. So while our theory speaks of approximating the eigenvalues of the linearized system, we do not incur this cost. 

Moreover, a static value of $p$ offers the advantage that the linear system to be solved is the same at each time step, i.e.\ the matrix to be inverted is static. Any expensive preprocessing/factorizing of this matrix needs only be done once.

\section{Image Inpainting}
Image inpainting is the task of repairing corrupted images and damaged artwork \cite{bertalmio2000image}. In the inpainting examples to follow, the user identifies in the image the region to be inpainted, and from there, a PDE model is evolved to fill-in the inpainting region using the neighbouring information.

Two PDE models are selected. The first is a second order model from Shen and Chan \cite{shen2002mathematical}, and the second is a recent fourth order model from Sch{\"o}nlieb and Bertozzi \cite{schonlieb2011unconditionally},
\begin{align}
        u_t  = \nabla \cdot \left(\frac{\nabla u}{\sqrt{\abs{\nabla u}^2 + \epsilon^2}} \right) 
+ \lambda_D(u_0 - u), 
\label{bv inpaint}
\end{align}
\begin{align}
         u_t  = -\Delta \nabla \cdot \left(\frac{\nabla u}{\sqrt{\abs{\nabla u}^2 + \epsilon^2}} \right) 
+ \lambda_D(u_0 - u).
\label{tvhneg inpaint}
\end{align}
We refer to these as TV inpainting and TV-H$^{-1}$ inpainting.

The solution, $u$, is the inpainted image we seek. The quantity, $u_0$, is the initially corrupted image, and $\epsilon > 0$ is a regularization parameter. Denoting the image domain $\Omega$, and the inpainting region, $D$, we then define $\lambda_D$ as 
\begin{align}
\lambda_D(x)
= \begin{cases}
\lambda_0, & x\in \Omega\setminus D
\\
0, &\text{otherwise},
\end{cases}
\end{align}
for some $\lambda_0 > 0$.

As for initial conditions, we have two vandalized images to be restored. The first is \cref{fig:turtle with text} where we have a photograph of a turtle overwritten with text. We would like to restore the photograph by removing the text. The second is \cref{fig:bullfinch and fox}, where fox figure requires removal. Although this may look simpler, it is in fact a more challenging scenario. The reason being that the thickness of the inpainting region requires correctly extending level lines over long distances \cite{schonlieb2011unconditionally}.

The image is restored in a channel-by-channel manner. As a stopping criteria, we look at the difference in successive images, 
\begin{align}
        \frac{\norm{u^{n+1} - u^n}_2}{\norm{u^{n+1}}_2} < \mathrm{tol},
\end{align}
where the tolerance is set at $\mathrm{tol}=\num{9e-5}$.  In addition, we also set a maximum of 500 iterations per channel. We report the time step-size and the total number of iterations used for each scheme.

Finally, we note that the spatial discretization is by second order centred differences with uniform spacing, $h$, in both $x$ and $y$.
\begin{figure}[htb!]
        \centering 
\includegraphics[width=0.65\textwidth]{turtle_with_text}
\caption[Photograph of turtle overwritten with text.]{Photograph of turtle overwritten with text.}
\label{fig:turtle with text}
\end{figure}

\begin{figure}[htb!]
        \centering 
\includegraphics[width=0.65\textwidth]{bullfinch_and_fox}
\caption[Photograph of a bullfinch vandalized by a cartoonish fox.]{Photograph of a bullfinch vandalized with a cartoon fox.}
\label{fig:bullfinch and fox}
\end{figure}

\subsection{TV inpainting}
We first show that the TV inpainting model can easily be handled by our methods. In this model, there are two terms on the righthand side, both potentially stiff.  The second term is  stabilized by adding and subtracting $-p_2\lambda_0 u$, and we determined $p_2=p_0$. For the first term we stabilize by adding and subtracting $p_1\Delta u$. To determined $p_1$, we first bound the first term as 
\begin{align}
\begin{split}
        \nabla \cdot \left(\frac{\nabla u}{\sqrt{\abs{\nabla u}^2 + \epsilon^2}} \right) 
&= \frac{u_{xx}(u_y^2 + \epsilon^2) + u_{yy}(u_x^2 + \epsilon^2)}{(u_x^2 + u_y^2 + \epsilon^2)^{3/2}} 
- \frac{2u_xu_y u_{xy}}{(u_x^2 + u_y^2 + \epsilon^2)^{3/2}} 
\\
&\leq \frac{(u_{xx}+u_{yy})(u_x^2 + u_y^2 + \epsilon^2)}{(u_x^2 + u_y^2 + \epsilon^2)^{3/2}} + \frac{(u_x^2 + u_y^2 + \epsilon^2)u_{xy}}{(u_x^2 + u_y^2 + \epsilon^2)^{3/2}}  
\\
&= \frac{u_{xx} + u_{yy} + u_{xy}}{\sqrt{u_x^2 + u_y^2 + \epsilon^2}}.
\end{split}
\label{p1 estimate inpaint 1}
\end{align}
We then consider the auxilliary equation $u_t = u_{xx} + u_{yy} + u_{xy}$ discretized by centred differences in space and forward Euler in time to apply a von Neumann analysis with $u^n_{jk} = \xi^n \exp(i\omega_1jh)\exp(i\omega_2kh)$ to get 
\begin{align}
        \frac{\xi  - 1}{\Delta t} 
= \frac{1}{h^2}(-4 + 2\cos(\omega_1 h) + 2\cos(\omega_2 h) - \sin(\omega_1 h)\sin(\omega_2h))
\geq -\frac{8.5}{h^2}.
\label{p1 estimate inpaint 2}
\end{align}
Combined with the assumption of the extreme case, $\sqrt{u_x^2 + u_y^2 + \epsilon^2} \geq \epsilon$, we set $p_2$ according to 
\begin{align}
        p_1\frac{8/h^2}{8.5/(\epsilon h^2)} \geq p_0 \iff 
p_1 \geq \frac{8.5}{8\epsilon}p_0.
\end{align}

The images restored by TV inpainting are shown in \cref{fig:bv inpainting}. We restored using SBDF1, SBDF2, and CNAB for time stepping. Parameters were set as $\epsilon=0.10$ and $\lambda_0=20$. \cref{tab:bv iter counts} charts the least iteration count we achieved with each method. The numbers show a definite improvement of using the second order methods over the first order. 
\begin{figure}[htb!]
\centering
\begin{minipage}{0.65\textwidth}
	\includegraphics[width=\textwidth]{bv_turtle}
\end{minipage}
\begin{minipage}{0.65\textwidth}
	\includegraphics[width=\textwidth]{bv_bullfinch}
\end{minipage}
\caption[Image restoration by TV inpainting.]{Image restoration by TV inpainting using a second order linearly stabilized time stepping method.}
\label{fig:bv inpainting}
\end{figure}

% \begin{figure}[htb!]
%         \centering
% \includegraphics[width=0.65\textwidth]{bv_bullfinch_s1}
% \caption[Image restoration by TV inpainting -- SBDF1.]{Image restoration by TV inpainting using SBDF1.}
% \label{fig:bv bullfinch s1}
% \end{figure}

\begin{table}[htb!]
\caption[Iteration counts for TV image restoration.]{Iteration counts for TV image restoration.}
        \centering\begin{tabular}{lll ll} \toprule[1.25pt]
& \multicolumn{2}{c}{Sea Turtle} & \multicolumn{2}{c}{Bullfinch}
\\
& $\Delta t$ & Iterations & $\Delta t$ & Iterations
\\ \midrule
SBDF1 & 0.50 & 141 & 0.33 & 393 
\\
SBDF2& 0.18 & 115 & 0.22 & 168
\\             
CNAB &  0.16 & 104 & 0.18 & 195
\\ \bottomrule[1.25pt]
\end{tabular}
\label{tab:bv iter counts}
\end{table}

\subsection{TV-H\texorpdfstring{$^{-1}$}{-1} inpainting}
For TV-H$^{-1}$ inpainting, we stabilize \cref{tvhneg inpaint} as 
\begin{align}
        u_t = -\Delta \nabla \cdot \left(\frac{\nabla u}{\sqrt{\abs{\nabla u}^2 + \epsilon^2}} \right) + \lambda_D(u_0 - u)  + p_1\Delta^2 u + p_2\lambda_0 u - p_1\Delta^2 u - p_2\lambda_0 u.
\label{tvhneg stabilized}
\end{align}
We note $p_2$ is chosen exactly as in TV inpainting. Determination of $p_1$ makes use of the bound set in \cref{p1 estimate inpaint 1,p1 estimate inpaint 2} to get 
\begin{align}
        p_1\frac{(8/h^2)^2}{(8/h^2)(8.5/(\epsilon h^2))} \geq p_0 
\iff p_1 \geq \frac{8.5}{8\epsilon}p_0,
\end{align}
which is also the same as TV inpainting.

Interestingly, in the same paper where they propose \cref{tvhneg inpaint} for image inpainting, they offer exactly \cref{tvhneg stabilized} and time stepping with SBDF1 as the solution algorithm. In \cref{tab:bvhneg iter counts}, we chart again the least iteration counts achieved with each of SBDF1, SBDF2, CNAB, with parameters $\epsilon=0.10$ and $\lambda_0=30$. Once again, the second order methods are an improvement over the first order method, with the improvement especially notable in the more difficult example with the bullfinch. 

As a final note, we would like to mention other interesting developments in \cite{bredies2010total,papafitsoros2014combined,papafitsoros2013combined}. In these papers, they propose a number of image restoration models involving a number of high order derivatives interacting nonlinearly. It would be of some interest to compare the effectiveness of our schemes with the methods they propose.

\begin{figure}[htb!]
	\centering
\begin{minipage}{0.65\textwidth}
	\includegraphics[width=\textwidth]{bvhneg_turtle}
\end{minipage}
\begin{minipage}{0.65\textwidth}
	\includegraphics[width=\textwidth]{bvhneg_bullfinch}
\end{minipage}
\caption[Image restoration by TV-H$^{-1}$ inpainting.]{Image restoration by TV-H$^{-1}$ inpainting using a second order linearly stabilized time stepping method.}
\label{fig:bvhneg inpainting}
\end{figure}

\begin{table}[htb!]
\caption[Iteration counts for TV-H$^{-1}$ image restoration.]{Iteration counts for TV-H$^{-1}$ image restoration.}
        \centering\begin{tabular}{lll ll} \toprule[1.25pt]
& \multicolumn{2}{c}{Sea Turtle} & \multicolumn{2}{c}{Bullfinch}
\\
& $\Delta t$ & Iterations & $\Delta t$ & Iterations
\\ \midrule
SBDF1 & 0.65 & 143 & 0.30 & 1002
\\
SBDF2& 0.12 & 119 & 0.54 & 401 
\\             
CNAB & 0.10 & 108 & 0.64 & 347
\\ \bottomrule[1.25pt]
\end{tabular}
\label{tab:bvhneg iter counts}
\end{table}


\section{Motion by Mean Curvature}
In this section, we study the problem of computing motion by mean curvature flow. The level set equation for mean curvature flow is 
\begin{align}
        u_t 
= \kappa\abs{\nabla u} 
= \abs{\nabla u} \nabla \cdot \left(\frac{\nabla u}{\abs{\nabla u}} \right).
\end{align}
In these problems, the interest is in the time evolution of the interface, $\Gamma=\Gamma(t)$, typically described by the zero level set of the function $u$,
\begin{align}
        \Gamma(t) = \{x \in \bR^d \mid u(x,t) =0\}.
\end{align}

We will demonstrate the effectiveness of our schemes on similar examples to that of Smereka \cite{smereka2003semi}. In his paper, he uses a linearly stabilized schemes to take large, stable time steps. In fact, it is also suggested in his paper that Richardson extrapolation may be used for second order, but was not implemented. We follow the example set in \cite{smereka2003semi} and stabilize with a Laplacian term $p\Delta u$ to get 
\begin{align}
        u_t = \kappa \abs{\nabla u} - p\Delta u + p\Delta u.
\end{align}
An analysis similar to \cref{p1 estimate inpaint 1,p1 estimate inpaint 2} gives $p\geq p_0$ to be sufficient for unconditional stability.

Let us point out a key difference between this problem and the inpainting problem of the previous section. In the inpainting problem, we drive the system to steady state.  As such, we were afforded a range of time step-sizes where the solution method performed well. The step-size did not affect the accuracy of the solution, only the computing time. With mean curvature flow, the step-size influences the accuracy of the solution, so we are really only interested in large time step-sizes if they maintain an acceptable level of accuracy.

\subsection{Shrinking dumbbell in 2D and 3D}
Our first example is a shrinking dumbbell-shaped curve in 2D. In \cref{fig:mcm 2d dumbbell} we show the shrinking of this curve under mean curvature flow. The solution to this problem at time $T=1.25$ with an explicit Runge-Kutta method, on a $256\times 512$ periodic grid with second order centred differences, costs $\O(10^4)$ time steps for stability.

\begin{figure}[htb!]
        \centering
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{dumbbell_0}
\end{minipage}%
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{dumbbell_001}
\end{minipage}
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{dumbbell_05}
\end{minipage}%
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{dumbbell_125}
\end{minipage}%
\caption[Mean curvature flow of a dumbbell-shaped curve in 2D.]{Mean curvature flow of a dumbbell-shaped curve in 2D. From the top left to the bottom right, the plots show the evolution at times $t=0$, $0.01$, $0.5$, $1.25$.}
\label{fig:mcm 2d dumbbell}
\end{figure}

In \cref{fig:mcm 2d conv}, we show the convergence of SBDF1, SBDF2, CNAB, EIN, ETDRK2, ETDRK4 to the problem of shrinking a dumbbell-shaped curve by mean curvature flow at time $T=1.25$ in the positive quadrant only. As shown, each scheme is stable and convergent  using a number of time steps much smaller than $10^4$. However, amongst the schemes, there is a major difference as to the number of time steps needed to achieve an acceptable level of accuracy. 

\begin{figure}[htb!]
        \centering
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{s1_conv}
\end{minipage}
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{ein_conv}
\end{minipage}
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{s2_conv}
\end{minipage}
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{erk2_conv}
\end{minipage}
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{cnab_conv}
\end{minipage}
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{erk4_conv}
\end{minipage}
\caption[Convergence of linearly stabilized schemes to a shrinking dumbbell problem.]{Convergence of various linearly stabilized time stepping to a 2D mean curvature flow problem. In the column to the left from top to bottom, we have SBDF1, SBDF2, and CNAB. In the column to the right from top to bottom, we have EIN, ETDRK2, and ETDRK4.}
\label{fig:mcm 2d conv}
\end{figure}

The most disappointing of these is CNAB, for which a minimum of 400 time steps to get a reasonable looking solution and needs 800 to present a solution competitive with the other methods. SBDF2 likewise faired poorly in that regards. 

On the other hand, the ETDRK schemes and the EIN method appears to do well at even 50-100 time steps. Recall that these are the schemes that have strong damping at infinity (see \cref{fig:damp fac at inf}). Zoom-ins to the solution by these schemes are provided in \cref{fig:mcm zoom in 1,fig:mcm zoom in 2}. The zoom-ins show that the ETDRK schemes converge nicely even at few time steps. The EIN method, however, is again hampered by slow convergence, and in this respect, its performance is worse than that of SBDF2 and CNAB. 

\begin{figure}[htb!]
        \centering
\includegraphics[width=0.65\textwidth]{ein_zoom1}
\includegraphics[width=0.65\textwidth]{erk2_zoom1}
\includegraphics[width=0.65\textwidth]{erk4_zoom1}
\caption[{A zoom-in over $ [0.0,0.2]\times [0.475,0.54]$ to inspect convergence.}]{A zoom-in over $[0.0, 0.2]\times [0.475, 0.54]$. From top to bottom we have the EIN method, ETDRK2, and ETDRK4. We see slow convergence of the EIN method, and good convergence of the ETDRK schemes.}
\label{fig:mcm zoom in 1}
\end{figure}

\begin{figure}[htb!]
        \centering
\begin{minipage}{0.30\textwidth}
        \includegraphics[width=0.92\textwidth]{ein_zoom2}
\end{minipage}
\begin{minipage}{0.30\textwidth}
        \includegraphics[width=0.92\textwidth]{erk2_zoom2}
\end{minipage}
\begin{minipage}{0.30\textwidth}
        \includegraphics[width=0.92\textwidth]{erk4_zoom2}
\end{minipage}
\caption[{A zoom-in over $[1.3,1.41]\times [0.0, 0.3]$ to inspect convergence.}]{A zoom-in over $[1.3,1.41]\times [0.0, 0.3]$. From left to right we have the EIN method, ETDRK2, and ETDRK4. We see slow convergence of the EIN method, and good convergence of the ETDRK schemes.}
\label{fig:mcm zoom in 2}
\end{figure}

Next, we take this example into 3D. Here, the advantages of our schemes are further magnified. In 2D, one could argue that the computations can be completed using standard explicit schemes within reasonable computing times. In 3D, doing so would mean trade offs in the grid size, or computing only over very short time periods. 

Setting the initial condition to be the dumbbell-shaped curve of the top left image in \cref{fig:mcm 3d dumbbell}, the curve is then evolved by mean curvature flow. We use a periodic grid of size $256\times 128\times 128$ and solved till time $T=0.75$. With forward Euler, we needed $3000$ time steps for stability, and this computation took over 28 minutes in \textsc{Matlab} 2014b on an Intel\textsuperscript{\textregistered}Core\textsuperscript{\texttrademark}i5-4570 CPU@3.20GHz workstation running Linux. With the linearly stabilized ETDRK2, we solved the same problem using 75 time steps in 103 seconds.

\begin{figure}[htb!]
        \centering
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{dumbbell_3d0}
\end{minipage}%
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{dumbbell_3d01}
\end{minipage}
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{dumbbell_3d03}
\end{minipage}%
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{dumbbell_3d0525}
\end{minipage}
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{dumbbell_3d055}
\end{minipage}%
\begin{minipage}{0.48\textwidth}
        \includegraphics[width=0.96\textwidth]{dumbbell_3d075}
\end{minipage}
\caption[Mean curvature flow of a dumbbell-shaped curve in 3D.]{Mean curvature flow of a dumbbell-shaped curve in 3D. From the left to right, top to bottom, the plots show the evolution at times $t=0$, $0.1$, $0.3$, $0.525$, $0.55$, $0.75$.}
\label{fig:mcm 3d dumbbell}
\end{figure}


\subsection{Anisotropic mean curvature motion}
So far, the motion law considered may be more appropriately described as isotropic mean curvature motion. In \cite{oberman2011aniso}, Oberman et at., present a method for anisotropic mean curvature flow: 
\begin{align}
        u_t = (\gamma(\omega) + \gamma''(\omega))\abs{\nabla u} \nabla \cdot \left( \frac{\nabla u}{\abs{\nabla u}} \right),
\end{align}
where $\omega = \arctan(u_y/u_x)$, and 
\begin{align}
        \gamma(\omega) 
= \gamma_n(\omega) 
= \frac{1}{n^2+1}(n^2 + 1 - \sin(n\omega)), 
\quad\text{for } n = 0,2,4,8.
\end{align}
For our methods, the added factor of $\gamma(\omega) + \gamma''(\omega)$ presents no additional difficulty at all. Setting $n=4$ and on a periodic grid of size $256\times 256$, we take 500 time steps to produce the solution presented in \cref{fig:aniso mcm}. 
\begin{figure}
        \centering
\begin{minipage}{0.44\textwidth}
       \includegraphics[width=0.96\textwidth]{aniso0}
\end{minipage}
\begin{minipage}{0.44\textwidth}
       \includegraphics[width=0.96\textwidth]{aniso001}
\end{minipage}
\begin{minipage}{0.44\textwidth}
       \includegraphics[width=0.96\textwidth]{aniso006}
\end{minipage}
\begin{minipage}{0.44\textwidth}
       \includegraphics[width=0.96\textwidth]{aniso016}
\end{minipage}
\caption[Anisotropic mean curvature flow.]{Anisotropic mean curvature flow in 2D. The plots show the evolution of the curve at times $t=0$, $0.01$, $0.06$, $0.16$. The initial curve gradually shrinks to a curve exhibiting four-fold symmetry before collapsing to a point.}
\label{fig:aniso mcm}
\end{figure}

\section{Phase Separation Models on Moo Surfaces}

\section{notes}
+ why are the problems different?

+ in the inpainting problem, the solution was found by driving the system to steady state. Restriction to a small time step-size merely lead to large run times and  The requirements on $\Delta t$ were not quite as stringent, with a large range of $\Delta t$ showing excellent performance for each scheme. In the mcm problem, choice of $\Delta t$ affects the accuracy of the solution, so it is important to be able to choose large step-sizes while maintaining accuracy.
